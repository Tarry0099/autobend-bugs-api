<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Autobend Bug Tracker</title>
</head>
<body>
  <h1>üêû Autobend Bug Tracker</h1>

  <input type="text" id="bugInput" placeholder="Funktioniert nicht im Bereich" />
  <input type="text" id="userInput" placeholder="Ihr Name" />
  <button onclick="submitBug()">Fehler melden</button>

  <h2>Fehlerliste</h2>
  <ul id="bugList"></ul>

  <script>
    const bugInput = document.getElementById("bugInput");
    const userInput = document.getElementById("userInput");
    const bugListElement = document.getElementById("bugList");

    async function loadBugs() {
      const res = await fetch("/bugs");
      const bugs = await res.json();

      bugListElement.innerHTML = "";
      bugs.forEach(bug => {
        const li = document.createElement("li");
        if (typeof bug === "object" && bug !== null) {
          li.textContent = `${bug.text} (von: ${bug.user})`;
        } else {
          li.textContent = bug;
        }
        bugListElement.appendChild(li);
      });
    }

    async function submitBug() {
      const text = bugInput.value.trim();
      const user = userInput.value.trim() || "Unbekannt";

      if (!text) return;

      const res = await fetch("/bugs", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text, user })
      });

      if (res.ok) {
        bugInput.value = "";
        userInput.value = "";
        loadBugs();
      }
    }

    loadBugs();
  </script>
</body>
</html>
